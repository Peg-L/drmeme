import{P as k,M as x}from"./PaginationComponent-39ddf7cc.js";import{g as M}from"./getDate-a6a896d2.js";import{_ as T,c as n,a as e,F as u,k as p,b as E,n as w,t as o,d as P,r as C,o as a}from"./index-c34ecdd2.js";const{VITE_APP_URL:h,VITE_APP_PATH:m}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"drmeme",VITE_APP_SPOTIFY_CLIENT_ID:"6ae98659652a4d86a9c6ca300f595a21",VITE_APP_SPOTIFY_CLIENT_SECRET:"08d3edfa0ca14a7382d7b286ac6b13c3",BASE_URL:"/drmeme/",MODE:"production",DEV:!1,PROD:!0};let b,_;const I={components:{PaginationComponent:k},data(){return{orders:[],tempOrder:{},pages:{},delAll:!1}},mixins:[M],methods:{getOrders(l=1){const d=`${h}/api/${m}/admin/orders?page=${l}`,f=document.cookie.replace(/(?:(?:^|.*;\s*)drmemeToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=f,this.$http.get(d).then(r=>{console.log(r.data),this.orders=r.data.orders,this.pages=r.data.pagination}).catch(r=>{console.log(r)})},openModal(l,d){l==="view"?(b.show(),this.tempOrder={...d}):l==="delete"?(this.delAll=!1,_.show(),this.tempOrder={...d}):l==="deleteAll"&&(this.delAll=!0,_.show())},viewOrder(l){const d=`${h}/api/${m}/admin/order/${l}`;this.$http.put(d,{data:this.tempOrder}).then(()=>{this.getOrders(),b.hide()})},deleteOrder(){const l=`${h}/api/${m}/admin/order/${this.tempOrder.id}`;this.$http.delete(l).then(()=>{this.getOrders(),_.hide()})},deleteAllOrders(){const l=`${h}/api/${m}/admin/orders/all`;this.$http.delete(l).then(()=>{this.getOrders(),_.hide()})}},mounted(){this.getOrders(),b=new x(this.$refs.orderModal),_=new x(this.$refs.delOrderModal)}},D={class:"py-3"},L={class:"d-flex justify-content-between"},N=e("h1",{class:"fs-4 fw-bold"},"訂單管理",-1),V={class:"table table-hover mt-4 align-middle"},$=e("thead",null,[e("tr",null,[e("th",null,"訂單日期"),e("th",null,"訂購人資訊"),e("th",null,"訂購商品"),e("th",null,"金額"),e("th",{width:"120"},"付款狀態"),e("th",{width:"120"},"編輯")])],-1),R=["onClick"],S=e("i",{class:"fa-solid fa-eye"},null,-1),B=[S],F=["onClick"],U=e("i",{class:"fa-solid fa-trash-can"},null,-1),j=[U],q={class:"d-flex justify-content-center"},z={class:"modal fade",ref:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true","data-bs-backdrop":"static"},H={class:"modal-dialog modal-dialog-scrollable modal-xl modal-fullscreen-xl-down"},Y={class:"modal-content"},G=e("div",{class:"modal-header bg-primary-500"},[e("h1",{class:"modal-title fs-5 fw-bold text-light",id:"orderModalLabel"}," 查看訂單 "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-5"},W={class:"border border-secondary-600 p-4 rounded-3"},X=e("h2",{class:"fs-5 fw-bold"},"訂單資料",-1),Z={class:"mt-3"},ee=e("label",{for:"inputOrderNumber",class:"form-label mb-1"},"訂單編號",-1),te=["value"],se={class:"mt-3"},le=e("label",{for:"inputOrderDate",class:"form-label mb-1"},"訂單日期",-1),oe=["value"],de={class:"mt-3"},ne=e("label",{for:"inputOrderPaid",class:"form-label mb-1"},"訂單付款狀態",-1),ae=["value"],re={class:"border border-secondary-600 p-4 mt-6 rounded-3"},ie=e("h2",{class:"fs-5 fw-bold"},"訂購人資訊",-1),ce={class:"mt-3"},_e=e("label",{for:"inputOrderPerson",class:"form-label mb-1"},"訂購人姓名",-1),ue=["value"],he={class:"mt-3"},me=e("label",{for:"inputOrderTel",class:"form-label mb-1"},"訂購人手機",-1),pe=["value"],be={class:"mt-3"},fe=e("label",{for:"inputOrderEmail",class:"form-label mb-1"},"訂購人Email",-1),ve=["value"],Oe={class:"mt-3"},ye=e("label",{for:"inputOrderAddress",class:"form-label mb-1"},"收件地址",-1),ge=["value"],xe={class:"mt-3"},we=e("label",{for:"inputOrderMsg",class:"form-label mb-1"},"訂單備註",-1),Pe=["value"],Ae={class:"col-sm-7"},ke={class:"border border-secondary-600 p-4 rounded-3"},Me=e("h2",{class:"fs-5 fw-bold"},"訂購商品",-1),Te={class:"table align-middle"},Ee=e("thead",null,[e("tr",null,[e("td",null,"縮圖"),e("td",null,"品項"),e("td",{width:"90"},"數量"),e("td",{class:"text-end"},"小計")])],-1),Ce=["src","alt"],Ie={class:"mb-0"},De={class:"text-end"},Le=e("td",{colspan:"3",class:"fs-3"},"總金額",-1),Ne={class:"text-end fs-3"},Ve={class:"modal fade",ref:"delOrderModal",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},$e={class:"modal-dialog"},Re={class:"modal-content border-0"},Se={class:"modal-header bg-danger text-white"},Be={id:"delOrderModalLabel",class:"modal-title"},Fe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ue={class:"modal-body"},je={key:0},qe={class:"text-danger"},ze={key:1},He=e("p",{class:"fw-bold mt-4"},"** 刪除後將無法恢復 **",-1),Ye={class:"modal-footer"},Ge=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Je(l,d,f,r,s,i){var v,O,y,g;const A=C("PaginationComponent");return a(),n(u,null,[e("div",D,[e("div",L,[N,e("button",{type:"button",class:"btn btn-outline-secondary-700 fw-bold",onClick:d[0]||(d[0]=t=>i.openModal("deleteAll",l.order))}," 刪除所有訂單 ")]),e("table",V,[$,e("tbody",null,[(a(!0),n(u,null,p(s.orders,t=>(a(),n("tr",{key:t.id},[e("td",null,o(l.getDate(t.create_at)),1),e("td",null,[e("ul",null,[e("li",null,o(t.user.name),1),e("li",null,o(t.user.email),1),e("li",null,o(t.user.tel),1)])]),e("td",null,[(a(!0),n(u,null,p(t.products,c=>(a(),n("ul",{key:c.product_id},[e("li",null,o(c.product.title)+" x "+o(c.qty),1)]))),128))]),e("td",null,"NT$ "+o(t.total),1),e("td",{class:w(["fw-bold",t.is_paid?"text-success":"text-danger"])},o(t.is_paid?"已付款":"未付款"),3),e("td",null,[e("button",{type:"button",class:"btn text-dark fw-bold",onClick:c=>i.openModal("view",t)},B,8,R),e("button",{type:"button",class:"btn text-dark fw-bold",onClick:c=>i.openModal("delete",t)},j,8,F)])]))),128))])]),e("div",q,[E(A,{pages:s.pages,"get-items":i.getOrders},null,8,["pages","get-items"])])]),e("div",z,[e("div",H,[e("div",Y,[G,e("div",J,[e("div",K,[e("div",Q,[e("div",W,[X,e("div",Z,[ee,e("input",{type:"text",class:"form-control",id:"inputOrderNumber",value:s.tempOrder.id,readonly:""},null,8,te)]),e("div",se,[le,e("input",{type:"text",class:"form-control",id:"inputOrderDate",value:l.getDate(s.tempOrder.create_at),readonly:""},null,8,oe)]),e("div",de,[ne,e("input",{type:"text",class:w(["form-control",s.tempOrder.is_paid?"text-success":"text-danger"]),id:"inputOrderPaid",value:s.tempOrder.is_paid?"已付款":"未付款",readonly:""},null,10,ae)])]),e("div",re,[ie,e("div",ce,[_e,e("input",{type:"text",class:"form-control",id:"inputOrderPerson",value:(v=s.tempOrder.user)==null?void 0:v.name,readonly:""},null,8,ue)]),e("div",he,[me,e("input",{type:"text",class:"form-control",id:"inputOrderTel",value:(O=s.tempOrder.user)==null?void 0:O.tel,readonly:""},null,8,pe)]),e("div",be,[fe,e("input",{type:"text",class:"form-control",id:"inputOrderEmail",value:(y=s.tempOrder.user)==null?void 0:y.email,readonly:""},null,8,ve)]),e("div",Oe,[ye,e("input",{type:"text",class:"form-control",id:"inputOrderAddress",value:(g=s.tempOrder.user)==null?void 0:g.address,readonly:""},null,8,ge)]),e("div",xe,[we,e("input",{type:"text",class:"form-control",id:"inputOrderMsg",value:s.tempOrder.message,readonly:""},null,8,Pe)])])]),e("div",Ae,[e("div",ke,[Me,e("table",Te,[Ee,e("tbody",null,[(a(!0),n(u,null,p(s.tempOrder.products,t=>(a(),n("tr",{key:t.id},[e("td",null,[e("img",{src:t.product.imageUrl,alt:t.product.title,class:"thumbnail"},null,8,Ce)]),e("td",null,[e("p",Ie,o(t.product.title),1)]),e("td",null,o(t.qty),1),e("td",De," NT$"+o(Math.round(t.final_total)),1)]))),128)),e("tr",null,[Le,e("td",Ne,"NT$ "+o(s.tempOrder.total),1)])])])])])])])])])],512),e("div",Ve,[e("div",$e,[e("div",Re,[e("div",Se,[e("h5",Be,[e("span",null,"刪除"+o(s.delAll?"所有":"該筆")+"訂單",1)]),Fe]),e("div",Ue,[s.delAll?(a(),n("p",ze,"是否刪除所有訂單")):(a(),n("p",je,[P(" 是否刪除編號 "),e("strong",qe,o(s.tempOrder.id)+" 訂單",1),P("? ")])),He]),e("div",Ye,[e("button",{type:"button",class:"btn btn-danger",onClick:d[1]||(d[1]=t=>s.delAll?i.deleteAllOrders():i.deleteOrder())}," 確認刪除"),Ge])])])],512)],64)}const Xe=T(I,[["render",Je]]);export{Xe as default};
